---
layout: post
title: Maven Multi-module Build Cycle Improved
date: '2013-05-25T23:03:00.001+02:00'
author: martin
tags:
- CI
- maven
modified_time: '2013-05-26T16:36:06.360+02:00'
blogger_id: tag:blogger.com,1999:blog-987786588703208935.post-6951938665471069767
blogger_orig_url: http://bxm-dev.blogspot.com/2013/05/maven-multi-module-build-cycle-improved.html
---

<p>When running a Maven build on a CI server like <a href="http://jenkins-ci.org/">Jenkins</a>, the first approach is to use a command similar to</p> <blockquote> <p>mvn -Dmaven.test.failure.ignore=true clean deploy</p></blockquote> <p>However, when faced with big projects consisting of many modules, this has some drawbacks:</p> <ul> <li>It can take a pretty long time until you get the feedback that you have broken the build. If e.g. there is a compilation problem in the last module, every unit test and integration test of every other module will be executed until this fatal error is reported.  <li>If the build on a module fails, all previous modules have already been deployed to the Maven repository, which leaves the repository in a potential unstable state (the latest SNAPSHOT versions may not be compatible to each other)</li></ul> <p>To work around these problems, I am using four Maven invocations instead of only one:</p> <blockquote> <p>mvn --fail-at-end -Dmaven.test.skip=true clean install<br>mvn --fail-at-end test<br>mvn --fail-at-end failsafe:integration-test failsafe:verify<br>mvn -Dmaven.test.skip=true -Dmaven.install.skip=true deploy</p></blockquote> <p>This results in a very quick compilation run first, then a quick execution of the unit tests (the source files won’t be compiled again because they haven’t changed since the first run), followed by a not-so-quick execution of the integration tests (which have already been compiled in the previous step), and finally the deployment of all artifacts.</p> <p>But this also has some downsides:</p> <ul> <li>I lose Jenkins’ “build unstable” feature, since a failed test now also fails the whole build and therefore turns the job red instead of yellow.  <li>There is a fast feedback about failed unit test, but feedback about integration tests is only available if all unit tests have passed.  <li>The third command is a <a href="http://stackoverflow.com/a/6612520/1126773">dirty hack</a> that will work only if the integration test don’t need the “pre-integration-test” and “post-integration-test” phases (I wanted to come up with a solution that needs no modification of the pom.xml files).</li></ul> <p>I will deal with these issues in my next post.</p> <p>(Note that the “maven.install.skip” option is only available for the <a href="http://maven.apache.org/plugins/maven-install-plugin/">maven-install-plugin</a> version 2.4 and above)</p> <p>A final note about <a href="https://cwiki.apache.org/MAVEN/parallel-builds-in-maven-3.html">parallel builds</a>: I wish that there was a way to tell Maven to recklessly parallelize the build without caring for module dependencies – because this would greatly reduce the execution time of the second, third, and forth build step…</p>  