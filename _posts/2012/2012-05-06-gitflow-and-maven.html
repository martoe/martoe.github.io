---
layout: post
title: Gitflow and Maven
date: '2012-05-06T21:15:00.000+02:00'
author: martin
tags: 
modified_time: '2012-07-02T16:05:45.377+02:00'
blogger_id: tag:blogger.com,1999:blog-987786588703208935.post-8260386316704681997
blogger_orig_url: http://bxm-dev.blogspot.com/2012/05/gitflow-and-maven.html
---

<a href="https://github.com/nvie/gitflow/wiki">Gitflow</a> is a best-practice <a href="http://nvie.com/posts/a-successful-git-branching-model/">branching model</a> for <a href="http://git-scm.com/docs">Git</a>. It is not a simple model, but it becomes really sophisticated when you try to combine it with Maven, which has <a href="http://maven.apache.org/plugins/maven-release-plugin/">its own release workflow</a>.<br />What I am trying to do here is to automate the Gitflow release actions (<i>release-start</i>, <i>release-finish</i>, <i>hotfix-start</i>, and <i>hotfix-finish</i>) for a mavenized project.<br /><br />Lets take a look at the basic workflows:<br />(Note: have a look at the <a href="http://nvie.com/img/2009/12/Screen-shot-2009-12-24-at-11.32.03.png">Gitflow diagramm</a> again before continuing)<br /><br /><h2>    The Release Workflow</h2>Suppose the pom.xml of the “develop” branch has version 1.5.0-SNAPSHOT (in my case, the second part contains the release version, and the third part contains the build or hotfix number).<br /><br /><b><i>release-start</i></b> should create the branch “release/1.5” (based on “develop”) and bump the “develop” version to 1.6.0-SNAPSHOT. Next it performs a <a href="http://maven.apache.org/plugins/maven-release-plugin/prepare-mojo.html">release-prepare</a> on the release branch, which means:<br /><ul><li>setting the version to 1.5.0 and tagging it</li><li>building and publishing to the Maven releases-repository</li><li>bumping the version to 1.5.1-SNAPSHOT</li></ul>Now the release branch is the place to perform all changes (bugfixes) to make the release stable (which probably includes the creation of subsequent versions 1.5.1, 1.5.2... as described above.<br /><br /><b><i>release-finish</i></b> first checks if the HEAD of the "release/1.5" branch is tagged (to make sure there are no commits after the most recent release plugin execution), then merges it to “master” as well as back to “develop”, and finally deletes the release branch.<br /><br /><h2>    The Hotfix Workflow</h2>Now our release (let's say it has version 1.5.3) is in production, and (whilst development on version 1.6.0-SNAPSHOT proceeds) we must apply an hotfix.<br /><br /><i><b>hotfix-start </b></i>would create the branch “hotfix/1.5.3” (based on “master”) and bump its version from 1.5.3 to 1.5.4-SNAPSHOT. All hotfix changes are now applied to this branch.<br />Every time we think we are ready for release, we again use the a <a href="http://maven.apache.org/plugins/maven-release-plugin/prepare-mojo.html">Release plugin</a> to build a new version.<br /><br /><i><b>hotfix-finish</b></i> is similar to release-finish: it cehcks if the HEAD of the hotfix branch is tagged, then&nbsp; merges it to “master” and “develop”. Furthermore, if the next release has already been started, the hotfix branch must also be merged to “release/1.6.0”. At the end, the branch is deleted.<br /><br /><h2>    Showstoppers</h2><ul><li>On both <i>release-finish</i> and <i>hotfix-finish</i>, the merge back to “develop” will ultimately fail, because both branches have modified the version number in the pom.xml file.</li><li>Besides this conflict, there is always the possibility of other merge conflicts, which prevents the <i>release-finish</i> and <i>hotfix-finish</i> steps from being executed non-interactive (e.g. on a CI server).</li><li>The merge from a hotfix branch to any pending release branch is not included in Gitflow (or maybe I have missed something?)</li></ul>&nbsp; <br /><h2>    Workaround: Scripting</h2>There is some discussion, but no real solution to these problems: Some suggest to <a href="http://maven.40175.n5.nabble.com/gitflow-releases-with-maven-td4630842.html">always use SNAPSHOT versions</a> to avoid the release merging conflict, or even <a href="http://www.insaneprogramming.be/?p=362">reverting the versionnumber before merging</a>, but most seem to avoid the Gitflow commands in these cases and <a href="https://gist.github.com/1043970">use the corresponding Git commands directly</a>.<br />So I wrote my own wrapper scripts for <i>release-start</i>, <i>release-finish</i>, <i>hotfix-start</i>, and <i>hotfix-finish</i> that bypass the showstoppers mentioned above:<br /><ul><li>Before merging a release or hotfix back to “develop”, the version is set to the version of the target branch (e.g. on branch "release/1.5", after merging to "master", I use "mvn version:set -DnewVersion=1.6.0-SNAPSHOT", commit this, and then do the merge.</li><li>Generally, if a merge back to “develop” fails, the script will carry on, but it won’t delete the branch and will raise an alert – now the developer nows that there is a dangling release (or hotfix) branch that needs a manual merge.</li></ul>There is no advantage in using Gitflow commands in these scripts - just the opposite: the scripts become more readable when avoiding Gitflow alltogether and sticking to the plan Git commands...