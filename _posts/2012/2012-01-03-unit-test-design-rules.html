---
layout: post
title: Unit Test Design Rules
date: '2012-01-03T21:12:00.001+01:00'
author: martin
tags:
- quality
- testing
modified_time: '2012-09-21T20:21:13.787+02:00'
blogger_id: tag:blogger.com,1999:blog-987786588703208935.post-20547658526948621
blogger_orig_url: http://bxm-dev.blogspot.com/2012/01/unit-test-design-rules.html
category: dev
---

Unit tests will fail. And you will spend much time finding out <i>why</i> a particular test has failed.<br>The key to reduce this time is writing <b>maintainable unit tests</b> - and the following rules should help here:<br>(Note that this is work in progress – I will edit rules and add new ones any time)<br><br> <h3>Unit Test Design Rules</h3> <h5>Every test method should have exactly one goal</h5> <ul> <li>Before writing a test, think about what <i>exactly</i> you want to test  <li>Don't handle different test cases with a single test method - use multiple methods instead <li>Every test must have at least one assertion </li></ul> <h5>The name of the test method should reflect its purpose</h5> <ul> <li>The method name should be a summary of the test case  <li>With <a href="http://testng.org/">TestNG</a>, you may use <a href="http://testng.org/javadocs/org/testng/annotations/Test.html#description%28%29">@Test(description)</a> instead  <li>And, please: don't prefix methods with "test"…</li></ul> <h5>A test should be easy to read</h5> <ul> <li>A test that reads like a specification or DSL is easy to understand and therefore easy to maintain  <li>Use the <a href="http://dannorth.net/introducing-bdd/">GIVEN-WHEN-THEN</a> template  <li>Encapsulate complex GIVEN and WHEN clauses in private methods</li></ul> <h5>A test should be independent, thread-safe, and free of side effects</h5> <ul> <li>Tests with dependencies or side effects lead to hard-to-find errors <li>Tests that require a database must not be data dependent (no assumptions about existing data) and must not leave traces in the database <li>Don't ever use TestNG's <a href="http://testng.org/javadocs/org/testng/annotations/Test.html#dependsOnMethods%28%29">@Test(dependsOnMethods)</a> attribute  <li>Some frameworks support parallel test execution – better be prepared!</li></ul> <h5>Don't use inheritance</h5> <ul> <li>Test classes should be final, so that tests cannot be overwritten or reused by subclasses <li>You may use abstract superclasses for easier code reuse, but these classes must not contaqin any tests</li></ul> <h5>Use mocking - but use it with care</h5> <ul> <li>Mocking remote interfaces and external resources will improve test performance and stability  <li>But mocking adds complexity to your test!  <li>Mock only things that really need to be mocked (don't use all features of your mocking framework just because you can)</li></ul> <h5>Avoid using in-memory-databases for tests</h5> <ul> <li>If your test is dependent of a database (it really is?) then you should use the real target platform - otherwise the test won't have much value  <li>If your test is database-independent, then you should try to mock all database accesses and run without any database</li></ul><br> <h3>Tools for Unit Testing</h3> <table style="width: 529px" border="0" cellspacing="0" cellpadding="5"> <tbody> <tr> <td valign="top" width="85"><a href="http://www.junit.org/">JUnit</a></td> <td valign="top" width="443">Still my favorite unit testing framework - small, simple, stable</td></tr> <tr> <td valign="top" width="85"><a href="http://testng.org/">TestNG</a></td> <td valign="top" width="443">Has a lot more features than JUnit (for me, the most important are <a href="http://testng.org/javadocs/org/testng/annotations/DataProvider.html">data providers</a> and <a href="http://testng.org/doc/documentation-main.html#parallel-running">parallel test execution</a>), but that comes with great complexity (what looks like a bug in your code or test may turn out to be a bug in the testing framework).<br>I try to stick to JUnit and use TestNG only for complex requirements.</td></tr> <tr> <td valign="top" width="85"><a href="http://code.google.com/p/hamcrest/">Hamcrest</a></td> <td valign="top" width="443">This is a great extension of JUnit and TestNG, since the assert statements of these frameworks are very poor (JUnit even uses the "wrong" order of arguments).<br>It greatly increases the readability of assertions (DSL-like).</td></tr> <tr> <td valign="top" width="85"><a href="http://fest.easytesting.org/">FEST</a></td> <td valign="top" width="443">Provides <a href="https://github.com/alexruiz/fest-assert-2.x/wiki">fluent assertions</a>, which are even nicer than Hamcrest (and don’t have those issues with generics)</td></tr> <tr> <td valign="top" width="85"><a href="http://easymock.org/">Easymock</a></td> <td valign="top" width="443">I use only very basic mocking features, so possibly any mocking framework would suffice.<br>Easymock was the first one I looked at, it has a nice and intuitive API - so I took it without evaluating any other.</td></tr></tbody></table><br> <h3>Links</h3> <ul> <li><a href="http://dannorth.net/introducing-bdd/">Behaviour-Driven Development</a></li></ul>  