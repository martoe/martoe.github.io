---
layout: post
title: 'Quartz (2): Spring'
date: '2007-08-29T16:00:00.000+02:00'
author: martin
tags:
- spring
modified_time: '2012-04-16T14:55:41.677+02:00'
blogger_id: tag:blogger.com,1999:blog-987786588703208935.post-219718414093146778
blogger_orig_url: http://bxm-dev.blogspot.com/2007/08/quartz-2-spring.html
category: dev
---

<p>Based on <a href="http://bxm.at/blogs/java/index.php?title=quartz_webapp&amp;more=1">Quartz in Webapps</a>, this shows how to use Spring to integrate Quartz:</p><ol><li>Add the JobDetails to the Spring context</li><li>Add the Trigger to the Spring context</li><li>Add the Scheduler to the Spring context</li><li>Improve the Job implementation</li></ol><ol><li><p>Add the JobDetails to the Spring context:<br />There goes the &#8220;message&#8221; parameter again. The &#8220;applicationContextJobDataKey&#8221; is needed to access the Spring context from within the Job.</p><pre class="brush:xml">&lt;bean id="exampleJob" class="org.springframework.scheduling.quartz.JobDetailBean"&gt;<br />&#160;&#160;&lt;property name="jobClass" value="example.ExampleJob"/&gt;<br />&#160;&#160;&lt;property name="applicationContextJobDataKey" value="springContext"/&gt;<br />&#160;&#160;&lt;property name="jobDataAsMap"&gt;<br />&#160;&#160;&#160;&#160;&lt;map&gt;&lt;entry key="message" value="Hello Spring"/&gt;&lt;/map&gt;<br />&#160;&#160;&lt;/property&gt;<br />&lt;/bean&gt;<br /></pre></li><p></p><li><p>Add the Trigger to the Spring context:<br />Again, 4 executions with 10 seconds intervalls. This time, we delay the startup by 5 seconds.</p><pre class="brush:xml">&lt;bean id="exampleTrigger" class="org.springframework.scheduling.quartz.SimpleTriggerBean"&gt;<br />&#160;&#160;&lt;property name="jobDetail" ref="exampleJob"/&gt;<br />&#160;&#160;&lt;property name="startDelay" value="5000"/&gt;<br />&#160;&#160;&lt;property name="repeatCount" value="3"/&gt;<br />&#160;&#160;&lt;property name="repeatInterval" value="10000"/&gt;<br />&lt;/bean&gt;<br /></pre></li><p></p><li><p>Add the Scheduler to the Spring context:<br />This factory bean adds the tigger to the scheduler and launches the scheduler.</p><pre class="brush:xml">&lt;bean name="quartzScheduler" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt;<br />&#160;&#160;&#160;&#160;&lt;property name="triggers"&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;list&gt;&lt;ref bean="exampleTrigger"/&gt;&lt;/list&gt;<br />&#160;&#160;&#160;&#160;&lt;/property&gt;<br />&lt;/bean&gt;<br /></pre></li><p></p><li><p>Improve the Job implementation:<br />Now, we may access our &#8220;message&#8221; using a local field! Furthermore, we have access to the Spring context.</p><pre class="brush:xml">package example;<br />&nbsp;<br />import org.quartz.JobExecutionContext;<br />import org.springframework.context.ApplicationContext;<br />import org.springframework.scheduling.quartz.QuartzJobBean;<br />&nbsp;<br />public class ExampleJob extends QuartzJobBean {<br />&nbsp;<br />&#160;&#160;&#160;&#160;private String message;<br />&nbsp;<br />&#160;&#160;&#160;&#160;public void setMessage(String value) {<br />&#160;&#160;&#160;&#160;&#160;&#160;message = value;<br />&#160;&#160;&#160;&#160;}<br />&nbsp;<br />&#160;&#160;&#160;&#160;protected void executeInternal(JobExecutionContext context) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;System.err.println(message);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ApplicationContext ctx = (ApplicationContext)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;context.getJobDetail().getJobDataMap().get("springContext");<br />&#160;&#160;&#160;&#160;}<br />&nbsp;<br />}<br /></pre></li><br /></ol><p></p><div class="item_footer"><p><small><a href="http://bxm.at/blogs/java/quartz_spring">Original post</a> blogged on <a href="http://b2evolution.net/">b2evolution</a>.</small></p></div>