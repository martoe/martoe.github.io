---
layout: post
title: One Jenkins Job for all Git Branches
date: '2012-06-04T19:28:00.002+02:00'
author: martin
tags: 
modified_time: '2012-06-04T19:28:35.836+02:00'
blogger_id: tag:blogger.com,1999:blog-987786588703208935.post-3068766657852696800
category: dev
---

My current task at work is to implement the <a href="https://github.com/nvie/gitflow">Gitflow branching model</a> for all our projects. So, each Git repository has a branch for develop, release, and production, as well as a few feature branches. Of course, all these branches should be built by our CI server.<br />Since most branches have a very short lifetime, I want the work to be done by a *single* CI job that is unaware of the branch it is currently working on. And this is harder than it may seem at first…<br /><h2> First try: plain Git plugin</h2>The <a href="https://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin">Jenkins Git plugin</a> supports wildcards as branch names. So, just enter "**" as branch specifier and activate the "Poll SCM" trigger. Now Jenkins triggers a build if it detects changes on any branch.<br /><h3> Issues:</h3><ul><li>It is not possible to manually start the job for a given branch (if you start the job, an arbitrary branch will be processed).  </li><li>There is <a href="https://issues.jenkins-ci.org/browse/JENKINS-10307">only one overall build result</a>, not a result per branch. So, a green job just means that the last processed branch is ok – but we don’t know if *all* branches are ok.</li><li>Jenkins <a href="http://stackoverflow.com/questions/3858563/active-git-branch-is-no-branch-on-hudson-ci/4055820">checks out a commit rather than the HEAD of a branch</a> - this can be a problem with some post-build actions (at least the ${GIT_BRANCH} var tells us the name of the branch) </li></ul><h2> Improvement: parameterized build</h2>To start a job manually, you could introduce a build parameter called "Branch" with default value "**" and set the branch specifier to "${Branch}". Now you may enter the branch name when starting a build.<br />Unfortonately htis doesn't work: The "Poll SCM" trigger does no variable expansion, so builds won't be triggered (or, even stranger, the build is triggered but no checkout is performed). See e.g. <a href="https://issues.jenkins-ci.org/browse/JENKINS-10580">JENKINS-10580</a>&nbsp; - not an exact match, but the closest I could find.<br /><h2> Improvement: branch overview</h2>An extension of the Git plugin that shows the <a href="https://issues.jenkins-ci.org/browse/JENKINS-10307">per-branch build status</a> is <a href="https://github.com/dobesv/git-plugin/wiki">available on Github</a>. Since this is based on a older plugin version, you have to checkout the <a href="https://github.com/jenkinsci/git-plugin">plugin source code</a>, merge in these changes, and build your own version.<br />You can then access a branch overview using the "GitBuild Data" link on a build page, or with URL "http://[hostname]/job/[jobname]/lastBuild/git/".<br /><br /><a href="https://issues.jenkins-ci.org/browse/JENKINS-12006" title="https://issues.jenkins-ci.org/browse/JENKINS-12006"></a><br /><br />