---
layout: post
title: Sun JVM Memory Management
date: '2009-04-15T20:54:00.000+02:00'
author: martin
tags: 
modified_time: '2012-04-16T14:55:41.683+02:00'
blogger_id: tag:blogger.com,1999:blog-987786588703208935.post-2383255510805088291
blogger_orig_url: http://bxm-dev.blogspot.com/2009/04/sun-jvm-memory-management.html
category: dev
---

<p>Just a few facts and terms (which I tend to forget or mix up):</p><h4>Memory</h4><ul><li><p>The Sun-JVM process memory consists of the &#8220;Permanent Space&#8221; and the &#8220;Heap".</p></li><li><p>The <b>Permanent Space</b> (aka <b>Permanent Generation</b>) holds the bytecode of all loaded classes.<br />MBean (Client-VM): <code>java.lang:type=MemoryPool,name=Perm Gen</code><br />MBean (Server-VM): <code>java.lang:type=MemoryPool,name=PS Perm Gen</code></p></li><li><p>The &#8220;generational&#8221; <b>Heap</b> is divided into &#8220;Old Generation&#8221; and &#8220;Young Generation".<br />MBean: <code>java.lang:type=Memory</code> (HeapMemoryUsage)</p></li><li><p>The <b>Old Generation</b> (aka <b>Tentured Space</b>) contains long-lived objects and is cleaned only during a major garbage collection.<br />MBean (Client-VM): <code>java.lang:type=MemoryPool,name=Tenured Gen</code><br />MBean (Server-VM): <code>java.lang:type=MemoryPool,name=PS Old Gen</code></p></li><li><p>The <b>New Generation</b> (aka <b>New Space</b>) is subdivided into &#8220;Eden&#8221; and two <b>Survivor Spaces</b> named &#8220;From Space&#8221; and &#8220;To Space".</p></li><li><p><b>Eden</b> is for new and short-lived objects. Initial size is usually 32MB or 64MB, may be overwritten with <code>-XX:NewSize</code> and <code>-XX:MaxNewSize</code>.</p></li><li><b>From Space</b> and <b>To Space</b> contain objects that have survived a minor garbage collection. Initial size is usually 1MB or 2MB each, may be overwritten with <code>-XX:SurvivorRatio</code>.</li></ul><h4>Garbage Collection</h4><ul><li><p>A <b>Minor Collection</b> (aka <b>Copy Collection</b>) cleans up Eden and moves the remaining objects up to the survivor spaces (and later into the tentured space)</p></li><li><p>A <b>Major Collection</b> (aka <b>Stop-the-World Collection</b>, aka <b>Mark-and-Sweep</b>, aka <b>Mark-Sweep-Compact</b>) is executed when a minor collection cannot reclaim enough memory (which should not occur more often than twice an hour) . It cleans up the whole heap (the young generation is empty afterwards).</p></li></ul><p>The available collectors are:</p><ul><li><p><b>Serial Collector</b> (default on Client-VM)<br /><code>-XX:+UseSerialGC</code><br />minor MBean: <code>java.lang:type=GarbageCollector,name=Copy</code><br />major MBean: <code>java.lang:type=GarbageCollector,name=MarkSweepCompact</code></p></li><li><p><b>Parallel Collector</b> (aka <b>Throughput Collector</b>, default on Server-VM)<br /><code>-XX:+UseParallelGC</code><br />minor MBean: <code>java.lang:type=GarbageCollector,name=PS Scavenge</code><br />major MBean: <code>java.lang:type=GarbageCollector,name=PS MarkSweep</code></p></li><li><p><b>Parallel Compacting Collector</b><br /><code>-XX:+UseParallelOldGC</code></p></li><li><b>Concurrent Mark-Sweep Collector</b> (aka <b>Low-Latency Collector</b>)<br /><code>-XX:+UseConcMarkSweepGC</code></li></ul><p>(Note: all data refer to Java 6)</p><h4>Recommended memory sizes (<a href="http://www.apress.com/book/view/1590596102">Steven Haines</a>, Java 5):</h4><ul><li>Hint: allocate the heap at once (i.e. <code>-Xms1024m -Xmx1024m</code> for a 1GB heap)</li><li>Young generation: a little less than half the heapsize (i.e. <code>-XX:NewSize=448m -XX:MaxNewSize=448m</code> for a 1GB heap)</li><li>Each survivor space: 1/8 of the young generation (i.e. <code>-XX:SurvivorRatio=6</code>)</li><li>Permanent space: start with 128MB, max 256MB (i.e. <code>-XX:PermSize=128m -XX:MaxPermSize=128m</code>) - this value is <em>not</em> part of the heap!</li></ul><p>See also:</p><ul><li><a href="http://java.sun.com/javase/technologies/hotspot/gc">http://java.sun.com/javase/technologies/hotspot/gc</a> (esp. <a href="http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html">Garbage Collection Tuning</a> and <a href="http://java.sun.com/javase/technologies/hotspot/gc/memorymanagement_whitepaper.pdf">Memory management</a>)</li><li><a href="http://java.sun.com/javase/6/docs/technotes/guides/vm#features">http://java.sun.com/javase/6/docs/technotes/guides/vm#features</a> (esp. <a href="http://java.sun.com/javase/6/docs/technotes/guides/vm/gc-ergonomics.html">Garbage Collector Ergonomics</a>)</li><li><a href="http://java.sun.com/performance/reference/whitepapers/6_performance.html">Java SE 6 Performance White Paper</a></li><li><a href="http://java.sun.com/javase/6/webnotes/trouble">Troubleshooting Java SE</a></li></ul><div class="item_footer"><p><small><a href="http://bxm.at/blogs/java/sun-jvm-memory-management">Original post</a> blogged on <a href="http://b2evolution.net/">b2evolution</a>.</small></p></div>