---
layout: post
title: Integration Build with Maven
date: '2007-05-09T17:53:00.000+02:00'
author: martin
tags:
- maven
modified_time: '2012-04-17T00:09:49.828+02:00'
blogger_id: tag:blogger.com,1999:blog-987786588703208935.post-5799324506543605388
blogger_orig_url: http://bxm-dev.blogspot.com/2007/05/integration-build-with-maven.html
---

<p>I recently switched a project's build process from Ant to Maven, but what's left to do is to integrate it with CruiseControl.</p><p>I know, <a href="http://maven.apache.org/continuum/">Continuum</a> would be the first choise for Maven builds, but I don't want to set up a second CI server (and Continuum doesn't offer the flexibility of CruiseControl, I might add).</p><p>The suggested way is to add the <a href="http://maven.apache.org/scm/plugins/">SCM plugin</a> to each project's pom.xml and use the CruiseControl <a href="http://cruisecontrol.sourceforge.net/main/configxml.html#maven2">"maven2"</a> tag to start the build process.<br />However, this has one big disadvantage: You have to perform a initial checkout manually before you can start the first CI build (first because Maven needs a pom.xml to start with, and second because the SCM plugin supports only CVS updates).</p><p>Now, a CI build (as I understand it) should be able to run out-of-the-box in a clean environment, and should definitly not be dependent of some artifacts that a previous build might (and might not) have left.</p><p>For a simple approch, I am using two CruiseControl builders: First, to CVS-checkout the required files with Ant (a four-line script), then to start the Maven build.<br />This way, I don't even have to extend my pom.xml files...</p><blockquote><pre class="brush:xml"><br />&lt;schedule&gt;<br />  &lt;composite&gt;<br />    &lt;ant buildfile="myproject.xml" target="checkout"/&gt;<br />    &lt;maven2 mvnhome="${env.M2_HOME}"<br />             pomfile="checkoutdir/myproject/pom.xml"<br />             goal="install" flags="-U"&gt;<br />      &lt;property name="maven.test.skip" value="true"/&gt;<br />    &lt;/maven2&gt;<br />  &lt;/composite&gt;<br />&lt;/schedule&gt;<br /></pre></blockquote><br /><br /><p>Well, works <em>almost</em>.<br /><br />The "maven2" builder expects the "checkoutdir/myproject/pom.xml" file to be present even before the "ant" task has been executed. I fixed that with a bootstrapper:</p><br /><br /><blockquote><pre class="brush:xml"><br />&lt;bootstrappers&gt;<br />  &lt;antbootstrapper buildfile="myproject.xml" target="bootstrap"/&gt;<br />&lt;/bootstrappers&gt;<br /></pre></blockquote><br /><br /><p>The Ant script's "bootstrap" target performs a minimal CVS checkout that just contains the single pom.xml file.<br /><br />Note: You cannot use the <a href="http://cruisecontrol.sourceforge.net/main/configxml.html#cvsbootstrapper">cvsbootstrapper</a> since it - deja vu - doesn't support initial checkouts.</p><br /><div class="item_footer"><p><small><a href="http://bxm.at/blogs/java/integration_build_with_maven">Original post</a> blogged on <a href="http://b2evolution.net/">b2evolution</a>.</small></p></div>